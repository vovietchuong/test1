<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quản lý Trung tâm - Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
  <style>
    :root {
      --primary: #4e73df; --secondary: #858796; --success: #1cc88a;
      --info: #36b9cc; --warning: #f6c23e; --danger: #e74a3b;
      --light: #f8f9fc; --dark: #5a5c69; --sidebar-width: 220px;
      --header-height: 60px; --body-bg: #f8f9fc; --card-bg: #fff;
      --border-color: #e3e6f0;
      --box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
      --border-radius: 0.35rem;
    }
    body { background-color: var(--body-bg); font-family: "Segoe UI", Tahoma, Arial, sans-serif; color: var(--dark); }
    #wrapper { display: flex; }
    #sidebar { width: var(--sidebar-width); min-height: 100vh; background-color: var(--primary); transition: margin-left 0.3s ease; z-index: 1030; }
    #content-wrapper { flex-grow: 1; display: flex; flex-direction: column; width: calc(100% - var(--sidebar-width)); }
    #main-content { padding: 24px; }
    .page-section { display: none; }
    .page-section.active { display: block; }
    @media (max-width: 768px) {
      #sidebar { margin-left: calc(-1 * var(--sidebar-width)); }
      #sidebar.toggled { margin-left: 0; }
      #content-wrapper { width: 100%; }
    }
    #login-container, #loading-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: var(--body-bg); display: flex; align-items: center; justify-content: center; z-index: 2000; }
    #login-card { max-width: 400px; width: 100%; }
    .d-none { display: none !important; }
    .sidebar-brand { height: var(--header-height); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; color: #fff; text-decoration: none; }
    .sidebar-nav-item { display: block; color: rgba(255,255,255,0.8); padding: 1rem 1.5rem; text-decoration: none; transition: all 0.2s ease; cursor: pointer; }
    .sidebar-nav-item:hover, .sidebar-nav-item.active { background-color: rgba(255,255,255,0.1); color: #fff; }
    .sidebar-nav-item i { margin-right: 10px; }
    #header { height: var(--header-height); background: var(--card-bg); box-shadow: var(--box-shadow); padding: 0 1.5rem; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1020; }
    .card { border: 1px solid var(--border-color); box-shadow: var(--box-shadow); border-radius: var(--border-radius); margin-bottom: 24px; }
    .stat-card { border-left: 4px solid var(--primary); transition: transform 0.2s ease-in-out; }
    .stat-card:hover { transform: translateY(-5px); }
    .stat-card.border-success { border-color: var(--success); }
    .stat-card.border-info { border-color: var(--info); }
    .stat-card.border-warning { border-color: var(--warning); }
    .stat-card.border-danger { border-color: var(--danger); }
    .stat-card .card-body { padding: 1.5rem; }
    .stat-card .stat-icon { font-size: 2rem; opacity: 0.3; }
    #conflict-card .list-group-item { font-size: 0.9rem; padding: 0.5rem 1rem; }
    .fc { --fc-border-color: var(--border-color); --fc-today-bg-color: rgba(78, 115, 223, 0.05); --fc-page-bg-color: transparent; height: 75vh; }
    .fc .fc-toolbar-title { font-size: 1.25rem; }
    .fc-event { padding: 4px 6px; font-size: 0.8em; border-radius: 4px; cursor: pointer; color: #fff !important; }
    .fc-event.conflict-event { background-color: var(--danger) !important; border: 2px dashed #fff !important; }
    .fc-past { opacity: 0.7; }
    .text-primary { color: var(--primary) !important; }
    .text-danger { color: var(--danger) !important; }
    .table-responsive-cards .no-data-row td { text-align: center; color: var(--secondary); font-style: italic; }
    #attendanceModal .student-row .form-check { margin-left: auto; }
    
    /* New styles for teacher attendance */
    .attendance-header { 
      background-color: #f8f9fa; 
      border-bottom: 2px solid #dee2e6; 
      padding: 1rem; 
      margin-bottom: 1rem; 
    }
    .attendance-title { 
      color: #2c3e50; 
      font-weight: 700; 
      margin-bottom: 0.5rem; 
    }
    .attendance-subtitle { 
      color: #6c757d; 
      font-size: 0.9rem; 
    }
    .teacher-attendance-card {
      border: 1px solid #dee2e6;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .teacher-attendance-card .card-header {
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      font-weight: 600;
      padding: 0.75rem 1rem;
    }
    .attendance-student-row {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e9ecef;
    }
    .attendance-student-row:last-child {
      border-bottom: none;
    }
    .student-info {
      flex: 1;
    }
    .student-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .student-phone {
      font-size: 0.875rem;
      color: #6c757d;
    }
    .attendance-actions {
      display: flex;
      gap: 0.5rem;
    }
    .attendance-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #dee2e6;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    .attendance-btn.active {
      border-color: var(--success);
      background-color: rgba(28, 200, 138, 0.1);
    }
    .attendance-btn.absent.active {
      border-color: var(--danger);
      background-color: rgba(231, 74, 59, 0.1);
    }
    .attendance-btn i {
      font-size: 1.25rem;
    }
    .attendance-summary {
      background-color: #f8f9fa;
      border-top: 1px solid #dee2e6;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      font-weight: 600;
    }
    
    @media (max-width: 767px) {
        .table-responsive-cards thead { display: none; }
        .table-responsive-cards tr { display: block; margin-bottom: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); }
        .table-responsive-cards td { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; border-top: 1px solid var(--border-color); text-align: right; }
        .table-responsive-cards tr td:first-child { border-top: none; }
        .table-responsive-cards td::before { content: attr(data-label); font-weight: 600; margin-right: auto; text-align: left; }
        
        /* Mobile styles for attendance */
        .attendance-student-row {
          flex-direction: column;
          align-items: flex-start;
        }
        .attendance-actions {
          margin-top: 0.5rem;
          width: 100%;
          justify-content: flex-end;
        }
    }
  </style>
</head>
<body>

  <div id="loading-container"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>

  <div id="login-container" class="d-none">
    <div id="login-card" class="card shadow-lg">
      <div class="card-body p-5">
        <div class="text-center mb-4"><i class="bi bi-calendar-check fs-1 text-primary"></i><h3 class="mt-2">TRUNG TÂM KỸ NĂNG</h3><p class="text-secondary">Vui lòng đăng nhập để tiếp tục</p></div>
        <form id="loginForm">
          <div class="form-floating mb-3"><input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" required><label for="loginEmail">Email</label></div>
          <div class="form-floating mb-3"><input type="password" class="form-control" id="loginPassword" placeholder="Password" required><label for="loginPassword">Mật khẩu</label></div>
          <div id="loginError" class="alert alert-danger d-none" role="alert"></div>
          <div class="d-grid"><button type="submit" id="loginBtn" class="btn btn-primary btn-lg"><span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span><span class="button-text">Đăng nhập</span></button></div>
        </form>
      </div>
    </div>
  </div>


  <div id="wrapper" class="d-none">
    <nav id="sidebar">
      <a class="sidebar-brand" href="#"><i class="bi bi-calendar-check"></i><span>TRUNG TÂM</span></a>
      <a class="sidebar-nav-item active" data-target="dashboard-page"><i class="bi bi-speedometer2"></i> Dashboard</a>
      <a class="sidebar-nav-item" data-target="classes-page"><i class="bi bi-easel"></i> Lớp học</a>
      <a class="sidebar-nav-item admin-only" data-target="teachers-page"><i class="bi bi-person-video3"></i> Giáo viên</a>
      <a class="sidebar-nav-item hide-from-student" data-target="students-page"><i class="bi bi-people"></i> Học sinh</a>
      <a class="sidebar-nav-item hide-from-student" data-target="attendance-page"><i class="bi bi-check-circle-fill"></i> Điểm danh</a>
      <!-- New menu item for teacher attendance -->
      <a class="sidebar-nav-item teacher-only" data-target="teacher-attendance-page"><i class="bi bi-person-check"></i> Điểm danh theo GV</a>
    </nav>

    <div id="content-wrapper">
      <header id="header">
          <button id="sidebar-toggle" class="btn d-md-none"><i class="bi bi-list"></i></button>
          <div class="input-group" style="max-width: 400px;"><input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm..."><button class="btn btn-outline-secondary" type="button" id="clearSearchBtn"><i class="bi bi-x-lg"></i></button></div>
          <div class="ms-auto d-flex align-items-center"><span id="userDisplayName" class="d-none d-lg-inline me-2 text-secondary"></span><i class="bi bi-person-circle fs-3 text-primary me-3"></i><button id="logoutBtn" class="btn btn-outline-danger btn-sm"><i class="bi bi-box-arrow-right me-1"></i>Đăng xuất</button></div>
      </header>

      <main id="main-content">

        <div id="dashboard-page" class="page-section active">
          <div class="row">
            <div class="col-xl-3 col-md-6 mb-4"><div class="card stat-card border-info"><div class="card-body d-flex justify-content-between align-items-center"><div><div class="text-xs fw-bold text-info text-uppercase mb-1">Lớp học</div><div id="stats-classes" class="h5 mb-0 fw-bold">0</div></div><div class="stat-icon"><i class="bi bi-easel"></i></div></div></div></div>
            <div class="col-xl-3 col-md-6 mb-4 admin-only"><div class="card stat-card border-success"><div class="card-body d-flex justify-content-between align-items-center"><div><div class="text-xs fw-bold text-success text-uppercase mb-1">Giáo viên</div><div id="stats-teachers" class="h5 mb-0 fw-bold">0</div></div><div class="stat-icon"><i class="bi bi-person-video3"></i></div></div></div></div>
            <div class="col-xl-3 col-md-6 mb-4 hide-from-student"><div class="card stat-card border-primary"><div class="card-body d-flex justify-content-between align-items-center"><div><div class="text-xs fw-bold text-primary text-uppercase mb-1">Học sinh</div><div id="stats-students" class="h5 mb-0 fw-bold">0</div></div><div class="stat-icon"><i class="bi bi-people"></i></div></div></div></div>
            <div class="col-xl-3 col-md-6 mb-4"><div class="card stat-card border-danger"><div class="card-body d-flex justify-content-between align-items-center"><div><div class="text-xs fw-bold text-danger text-uppercase mb-1">Xung đột lịch</div><div id="stats-conflicts" class="h5 mb-0 fw-bold">0</div></div><div class="stat-icon"><i class="bi bi-exclamation-triangle"></i></div></div></div></div>
          </div>
          <div id="conflict-card" class="card border-danger" style="display: none;"><div class="card-header bg-danger text-white"><h6 class="mb-0 fw-bold"><i class="bi bi-exclamation-triangle-fill me-2"></i>Chi tiết các xung đột lịch</h6></div><div class="card-body p-0"><ul class="list-group list-group-flush" id="conflict-details-list"></ul></div></div>
          <div class="card"><div class="card-header d-flex flex-wrap justify-content-between align-items-center"><h5 class="mb-0 text-primary fw-bold me-3"><i class="bi bi-calendar-week me-2"></i>Thời khóa biểu</h5><div class="d-flex align-items-center ms-auto"><div class="me-2 admin-only"><select id="teacher-filter-select" class="form-select form-select-sm"><option value="all">Tất cả giáo viên</option></select></div><div class="btn-group" role="group" id="calendar-view-buttons"><button data-view="dayGridMonth" class="btn btn-sm btn-outline-primary">Tháng</button><button data-view="timeGridWeek" class="btn btn-sm btn-outline-primary active">Tuần</button><button data-view="timeGridDay" class="btn btn-sm btn-outline-primary">Ngày</button></div></div></div><div class="card-body"><div id="calendar"></div></div></div>
        </div>

        <div id="classes-page" class="page-section">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0 text-primary fw-bold"><i class="bi bi-easel me-2"></i>Danh sách lớp học</h5><button class="btn btn-success admin-only" data-bs-toggle="modal" data-bs-target="#addClassModal"><i class="bi bi-plus-circle me-1"></i>Thêm lớp mới</button></div>
              <div class="card-body"><div class="table-responsive table-responsive-cards"><table class="table table-striped table-hover" id="classesTable"><thead class="table-light"><tr><th>Tên lớp</th><th>Môn</th><th>Giáo viên</th><th>HS</th><th>Lịch học</th><th>Hành động</th></tr></thead><tbody></tbody></table></div></div>
            </div>
        </div>
        
        <div id="teachers-page" class="page-section">
            <div class="card"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0 text-primary fw-bold"><i class="bi bi-person-video3 me-2"></i>Danh sách giáo viên</h5><button class="btn btn-success admin-only" data-bs-toggle="modal" data-bs-target="#addTeacherModal"><i class="bi bi-plus-circle me-1"></i>Thêm giáo viên</button></div><div class="card-body"><div class="table-responsive table-responsive-cards"><table class="table table-hover" id="teachersTable"><thead class="table-light"><tr><th>Tên</th><th>Email</th><th>Môn Dạy</th><th class="admin-only">Hành động</th></tr></thead><tbody></tbody></table></div></div></div>
        </div>

        <div id="students-page" class="page-section">
            <div class="card"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0 text-primary fw-bold"><i class="bi bi-people me-2"></i>Danh sách học sinh</h5><button class="btn btn-success admin-only" data-bs-toggle="modal" data-bs-target="#addStudentModal"><i class="bi bi-plus-circle me-1"></i>Thêm học sinh</button></div><div class="card-body"><div class="table-responsive table-responsive-cards"><table class="table table-hover" id="studentsTable"><thead class="table-light"><tr><th>Tên</th><th>SĐT Phụ huynh</th><th>Lớp đã đăng ký</th><th class="admin-only">Hành động</th></tr></thead><tbody></tbody></table></div></div></div>
        </div>

        <div id="attendance-page" class="page-section">
          <div class="card">
              <div class="card-header"><h5 class="mb-0 text-primary fw-bold"><i class="bi bi-check-circle-fill me-2"></i>Lịch sử Điểm danh</h5></div>
              <div class="card-body">
                  <div class="row g-3 mb-3 p-3 bg-light border rounded">
                      <div class="col-md-4"><label for="attendance-class-filter" class="form-label">Lọc theo Lớp</label><select id="attendance-class-filter" class="form-select"></select></div>
                      <div class="col-md-4"><label for="attendance-student-filter" class="form-label">Lọc theo Học sinh</label><select id="attendance-student-filter" class="form-select"></select></div>
                      <div class="col-md-2"><label for="attendance-start-date" class="form-label">Từ ngày</label><input type="date" id="attendance-start-date" class="form-control"></div>
                      <div class="col-md-2"><label for="attendance-end-date" class="form-label">Đến ngày</label><input type="date" id="attendance-end-date" class="form-control"></div>
                  </div>
                  <div class="table-responsive"><table class="table table-bordered table-hover" id="attendanceHistoryTable"><thead class="table-light"><tr><th>Ngày</th><th>Lớp</th><th>GV</th><th>Có mặt</th><th>Vắng mặt</th></tr></thead><tbody><tr><td colspan="5" class="text-center">Vui lòng chọn bộ lọc để xem dữ liệu.</td></tr></tbody></table></div>
              </div>
          </div>
        </div>
        
        <!-- New Teacher Attendance Page -->
        <div id="teacher-attendance-page" class="page-section">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0 text-primary fw-bold"><i class="bi bi-person-check me-2"></i>Điểm danh theo Giáo viên</h5>
            </div>
            <div class="card-body">
              <div class="attendance-header">
                <h4 class="attendance-title">HỌC THÊM - LUYỆN THI KIẾN NĂNG</h4>
                <p class="attendance-subtitle mb-2">Liên hệ đăng ký học: Zalo/sđt: Mr Đông 0979.803.568</p>
                <p class="attendance-subtitle mb-0">Kiên trì học tập - Tài năng toả sáng</p>
              </div>
              
              <div class="mb-4">
                <h6 class="fw-bold mb-2">DANH SÁCH ĐIỂM DANH HỌC SINH - THEO GIÁO VIÊN</h6>
                <div class="row">
                  <div class="col-md-6">
                    <label for="teacher-attendance-filter" class="form-label">Chọn giáo viên:</label>
                    <select id="teacher-attendance-filter" class="form-select">
                      <option value="">-- Chọn giáo viên --</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="attendance-date-filter" class="form-label">Ngày điểm danh:</label>
                    <input type="date" id="attendance-date-filter" class="form-control" value="">
                  </div>
                  <div class="col-md-3">
                    <label for="attendance-class-filter-teacher" class="form-label">Lọc theo lớp:</label>
                    <select id="attendance-class-filter-teacher" class="form-select">
                      <option value="">Tất cả lớp</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <div id="teacher-attendance-content">
                <div class="text-center p-4 text-muted">
                  <i class="bi bi-person-check fs-1"></i>
                  <p class="mt-2">Vui lòng chọn giáo viên để xem danh sách điểm danh</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </main>
    </div>
  </div>

  <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

  <!-- Existing modals -->
  <div class="modal fade" id="addTeacherModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><form id="addTeacherForm" class="needs-validation" novalidate><div class="modal-header"><h5 class="modal-title">Thêm Giáo viên</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-2"><label class="form-label">Tên</label><input id="teacherName" class="form-control" required></div><div class="mb-2"><label class="form-label">Email</label><input id="teacherEmail" class="form-control" type="email" required></div><div class="mb-2"><label class="form-label">SĐT</label><input id="teacherPhone" class="form-control"></div><div class="mb-2"><label class="form-label">Môn</label><select id="teacherSubject" class="form-select" required><option selected disabled value="">Chọn môn...</option><option value="math">Toán</option><option value="physics">Vật lý</option><option value="chemistry">Hóa</option><option value="literature">Ngữ văn</option><option value="english">Tiếng Anh</option><option value="history">Lịch sử</option><option value="geography">Địa lý</option></select></div></div><div class="modal-footer"><button type="submit" id="saveTeacherBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Lưu</span></button></div></form></div></div></div>
  <div class="modal fade" id="editTeacherModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><form id="editTeacherForm" class="needs-validation" novalidate><div class="modal-header"><h5 class="modal-title">Sửa Giáo viên</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="editTeacherId"><div class="mb-2"><label class="form-label">Tên</label><input id="editTeacherName" class="form-control" required></div><div class="mb-2"><label class="form-label">Email</label><input id="editTeacherEmail" class="form-control" type="email" required></div><div class="mb-2"><label class="form-label">SĐT</label><input id="editTeacherPhone" class="form-control"></div><div class="mb-2"><label class="form-label">Môn</label><select id="editTeacherSubject" class="form-select" required><option value="math">Toán</option><option value="physics">Vật lý</option><option value="chemistry">Hóa</option><option value="literature">Ngữ văn</option><option value="english">Tiếng Anh</option><option value="history">Lịch sử</option><option value="geography">Địa lý</option></select></div></div><div class="modal-footer"><button type="submit" id="updateTeacherBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Cập nhật</span></button></div></form></div></div></div>
  <div class="modal fade" id="addStudentModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><form id="addStudentForm" class="needs-validation" novalidate><div class="modal-header"><h5 class="modal-title">Thêm Học sinh</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-2"><label class="form-label">Tên</label><input id="studentName" class="form-control" required></div><div class="mb-2"><label class="form-label">Email</label><input id="studentEmail" class="form-control" type="email" required></div><div class="mb-2"><label class="form-label">SĐT Phụ huynh</label><input id="studentPhone" class="form-control"></div><div class="mb-2"><label class="form-label">Chọn lớp</label><select id="studentClass" class="form-select" multiple size="5"></select></div></div><div class="modal-footer"><button type="submit" id="saveStudentBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Lưu</span></button></div></form></div></div></div>
  <div class="modal fade" id="editStudentModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><form id="editStudentForm" class="needs-validation" novalidate><div class="modal-header"><h5 class="modal-title">Sửa Học sinh</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="editStudentId"><div class="mb-2"><label class="form-label">Tên</label><input id="editStudentName" class="form-control" required></div><div class="mb-2"><label class="form-label">Email</label><input id="editStudentEmail" class="form-control" type="email" required></div><div class="mb-2"><label class="form-label">SĐT Phụ huynh</label><input id="editStudentPhone" class="form-control"></div><div class="mb-2"><label class="form-label">Chọn lớp</label><select id="editStudentClass" class="form-select" multiple size="5"></select></div></div><div class="modal-footer"><button type="submit" id="updateStudentBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Cập nhật</span></button></div></form></div></div></div>
  <div class="modal fade" id="addClassModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content"><form id="addClassForm" class="needs-validation" novalidate><div class="modal-header"><h5 class="modal-title">Thêm Lớp</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row"><div class="col-md-6"><div class="mb-2"><label class="form-label">Tên lớp</label><input id="className" class="form-control" required></div><div class="mb-2"><label class="form-label">Môn</label><select id="classSubject" class="form-select" required><option selected disabled value="">Chọn...</option><option value="math">Toán</option><option value="physics">Vật lý</option><option value="chemistry">Hóa</option><option value="literature">Ngữ văn</option><option value="english">Tiếng Anh</option><option value="history">Lịch sử</option><option value="geography">Địa lý</option></select></div><div class="mb-2"><label class="form-label">Giáo viên</label><select id="classTeacher" class="form-select" required></select></div></div><div class="col-md-6"><p class="fw-bold border-bottom pb-1">Buổi học 1</p><div class="mb-2"><label class="form-label">Phòng</label><input id="classRoom" class="form-control" placeholder="101..." required></div><div class="mb-2 row"><div class="col-6"><label class="form-label">Ngày</label><select id="classDay" class="form-select" required><option value="1">Thứ 2</option><option value="2">Thứ 3</option><option value="3">Thứ 4</option><option value="4">Thứ 5</option><option value="5">Thứ 6</option><option value="6">Thứ 7</option><option value="0">Chủ nhật</option></select></div><div class="col-6"><label class="form-label">Khung giờ</label><select id="classTime" class="form-select" required></select></div></div><hr><p class="fw-bold border-bottom pb-1">Buổi học 2 (tùy chọn)</p><div class="mb-2"><label class="form-label">Phòng</label><input id="classRoom2" class="form-control" placeholder="102..."></div><div class="mb-2 row"><div class="col-6"><label class="form-label">Ngày</label><select id="classDay2" class="form-select"><option value="">-- Không chọn --</option><option value="1">Thứ 2</option><option value="2">Thứ 3</option><option value="3">Thứ 4</option><option value="4">Thứ 5</option><option value="5">Thứ 6</option><option value="6">Thứ 7</option><option value="0">Chủ nhật</option></select></div><div class="col-6"><label class="form-label">Khung giờ</label><select id="classTime2" class="form-select"></select></div></div></div></div></div><div class="modal-footer"><button type="submit" id="saveClassBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Lưu lớp</span></button></div></form></div></div></div>
  <div class="modal fade" id="editClassModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content"><form id="editClassForm" class="needs-validation" novalidate><div class="modal-header"><h5 class="modal-title">Sửa Lớp</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="editClassId"><div class="row"><div class="col-md-6"><div class="mb-2"><label class="form-label">Tên lớp</label><input id="editClassName" class="form-control" required></div><div class="mb-2"><label class="form-label">Môn</label><select id="editClassSubject" class="form-select" required><option value="math">Toán</option><option value="physics">Vật lý</option><option value="chemistry">Hóa</option><option value="literature">Ngữ văn</option><option value="english">Tiếng Anh</option><option value="history">Lịch sử</option><option value="geography">Địa lý</option></select></div><div class="mb-2"><label class="form-label">Giáo viên</label><select id="editClassTeacher" class="form-select" required></select></div></div><div class="col-md-6"><p class="fw-bold border-bottom pb-1">Buổi học 1</p><div class="mb-2"><label class="form-label">Phòng</label><input id="editClassRoom" class="form-control" placeholder="101..." required></div><div class="mb-2 row"><div class="col-6"><label class="form-label">Ngày</label><select id="editClassDay" class="form-select" required><option value="1">Thứ 2</option><option value="2">Thứ 3</option><option value="3">Thứ 4</option><option value="4">Thứ 5</option><option value="5">Thứ 6</option><option value="6">Thứ 7</option><option value="0">Chủ nhật</option></select></div><div class="col-6"><label class="form-label">Khung giờ</label><select id="editClassTime" class="form-select" required></select></div></div><hr><p class="fw-bold border-bottom pb-1">Buổi học 2 (tùy chọn)</p><div class="mb-2"><label class="form-label">Phòng</label><input id="editClassRoom2" class="form-control" placeholder="102..."></div><div class="mb-2 row"><div class="col-6"><label class="form-label">Ngày</label><select id="editClassDay2" class="form-select"><option value="">-- Không chọn --</option><option value="1">Thứ 2</option><option value="2">Thứ 3</option><option value="3">Thứ 4</option><option value="4">Thứ 5</option><option value="5">Thứ 6</option><option value="6">Thứ 7</option><option value="0">Chủ nhật</option></select></div><div class="col-6"><label class="form-label">Khung giờ</label><select id="editClassTime2" class="form-select"></select></div></div></div></div></div><div class="modal-footer"><button type="submit" id="updateClassBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Cập nhật</span></button></div></form></div></div></div>
  <div class="modal fade" id="attendanceModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Điểm danh lớp <span id="attendanceClassName"></span></h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-3"><p class="mb-1"><strong>Giáo viên:</strong> <span id="attendanceTeacherName"></span></p><p class="mb-0"><strong>Ngày:</strong> <span id="attendanceDate"></span></p></div><div class="table-responsive"><table class="table table-striped" id="attendanceTable"><thead><tr><th>Học sinh</th><th>SĐT Phụ huynh</th><th>Trạng thái</th></tr></thead><tbody></tbody></table></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button><button type="button" id="saveAttendanceBtn" class="btn btn-primary"><span class="spinner-border spinner-border-sm d-none"></span><span class="button-text">Lưu điểm danh</span></button></div></div></div></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script>
    // Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAPcaScN-HrCcxiUz_J1QrrREF9sxCfvD8",
  authDomain: "mathhubvn.firebaseapp.com",
  projectId: "mathhubvn",
  storageBucket: "mathhubvn.firebasestorage.app",
  messagingSenderId: "1001364433767",
  appId: "1:1001364433767:web:ae1547dc7d1524a6319dc2",
  measurementId: "G-2YNQZ48JVK"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Application state
    const appState = {
      currentUser: null,
      userRole: null,
      teachers: [],
      students: [],
      classes: [],
      attendance: [],
      currentCalendarView: 'timeGridWeek'
    };

    // DOM elements
    const elements = {
      loadingContainer: document.getElementById('loading-container'),
      loginContainer: document.getElementById('login-container'),
      wrapper: document.getElementById('wrapper'),
      sidebar: document.getElementById('sidebar'),
      sidebarToggle: document.getElementById('sidebar-toggle'),
      userDisplayName: document.getElementById('userDisplayName'),
      logoutBtn: document.getElementById('logoutBtn'),
      loginForm: document.getElementById('loginForm'),
      loginEmail: document.getElementById('loginEmail'),
      loginPassword: document.getElementById('loginPassword'),
      loginBtn: document.getElementById('loginBtn'),
      loginError: document.getElementById('loginError'),
      pageSections: document.querySelectorAll('.page-section'),
      sidebarNavItems: document.querySelectorAll('.sidebar-nav-item'),
      searchInput: document.getElementById('searchInput'),
      clearSearchBtn: document.getElementById('clearSearchBtn'),
      calendarViewButtons: document.querySelectorAll('#calendar-view-buttons button'),
      teacherFilterSelect: document.getElementById('teacher-filter-select'),
      calendar: document.getElementById('calendar'),
      statsClasses: document.getElementById('stats-classes'),
      statsTeachers: document.getElementById('stats-teachers'),
      statsStudents: document.getElementById('stats-students'),
      statsConflicts: document.getElementById('stats-conflicts'),
      conflictCard: document.getElementById('conflict-card'),
      conflictDetailsList: document.getElementById('conflict-details-list'),
      classesTable: document.getElementById('classesTable'),
      teachersTable: document.getElementById('teachersTable'),
      studentsTable: document.getElementById('studentsTable'),
      attendanceHistoryTable: document.getElementById('attendanceHistoryTable'),
      attendanceClassFilter: document.getElementById('attendance-class-filter'),
      attendanceStudentFilter: document.getElementById('attendance-student-filter'),
      attendanceStartDate: document.getElementById('attendance-start-date'),
      attendanceEndDate: document.getElementById('attendance-end-date'),
      teacherAttendanceFilter: document.getElementById('teacher-attendance-filter'),
      attendanceDateFilter: document.getElementById('attendance-date-filter'),
      attendanceClassFilterTeacher: document.getElementById('attendance-class-filter-teacher'),
      teacherAttendanceContent: document.getElementById('teacher-attendance-content')
    };

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      initApp();
      setupEventListeners();
      setupCalendar();
      setupTimeSlots();
    });

    function initApp() {
      // Check authentication state
      auth.onAuthStateChanged(user => {
        if (user) {
          // User is signed in
          appState.currentUser = user;
          checkUserRole(user.uid);
        } else {
          // User is signed out
          showLogin();
        }
      });
    }

    function showLogin() {
      elements.loadingContainer.classList.add('d-none');
      elements.loginContainer.classList.remove('d-none');
      elements.wrapper.classList.add('d-none');
    }

    function showApp() {
      elements.loadingContainer.classList.add('d-none');
      elements.loginContainer.classList.add('d-none');
      elements.wrapper.classList.remove('d-none');
      loadInitialData();
    }

    function checkUserRole(uid) {
      // In a real app, you would check the user's role from Firestore
      // For demo purposes, we'll assume admin for now
      appState.userRole = 'admin';
      showApp();
    }

    function setupEventListeners() {
      // Login form
      elements.loginForm.addEventListener('submit', handleLogin);
      
      // Logout button
      elements.logoutBtn.addEventListener('click', handleLogout);
      
      // Sidebar toggle
      elements.sidebarToggle.addEventListener('click', toggleSidebar);
      
      // Sidebar navigation
      elements.sidebarNavItems.forEach(item => {
        item.addEventListener('click', () => {
          const target = item.getAttribute('data-target');
          showPage(target);
          
          // Update active state
          elements.sidebarNavItems.forEach(navItem => navItem.classList.remove('active'));
          item.classList.add('active');
        });
      });
      
      // Search functionality
      elements.searchInput.addEventListener('input', handleSearch);
      elements.clearSearchBtn.addEventListener('click', clearSearch);
      
      // Calendar view buttons
      elements.calendarViewButtons.forEach(button => {
        button.addEventListener('click', () => {
          const view = button.getAttribute('data-view');
          changeCalendarView(view);
          
          // Update active state
          elements.calendarViewButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
        });
      });
      
      // Teacher filter for calendar
      elements.teacherFilterSelect.addEventListener('change', refreshCalendar);
      
      // Attendance filters
      elements.attendanceClassFilter.addEventListener('change', updateAttendanceStudentFilter);
      elements.attendanceStudentFilter.addEventListener('change', loadAttendanceHistory);
      elements.attendanceStartDate.addEventListener('change', loadAttendanceHistory);
      elements.attendanceEndDate.addEventListener('change', loadAttendanceHistory);
      
      // Teacher attendance filters
      elements.teacherAttendanceFilter.addEventListener('change', loadTeacherAttendance);
      elements.attendanceDateFilter.addEventListener('change', loadTeacherAttendance);
      elements.attendanceClassFilterTeacher.addEventListener('change', loadTeacherAttendance);
      
      // Set today's date as default for attendance date filter
      const today = new Date().toISOString().split('T')[0];
      elements.attendanceDateFilter.value = today;
    }

    function setupCalendar() {
      elements.calendar = new FullCalendar.Calendar(elements.calendar, {
        initialView: 'timeGridWeek',
        headerToolbar: false,
        allDaySlot: false,
        slotMinTime: '07:00:00',
        slotMaxTime: '22:00:00',
        slotDuration: '01:00:00',
        height: 'auto',
        events: [],
        eventClick: function(info) {
          showAttendanceModal(info.event);
        },
        eventDidMount: function(info) {
          if (info.event.extendedProps.conflict) {
            info.el.classList.add('conflict-event');
          }
        }
      });
      
      elements.calendar.render();
    }

    function setupTimeSlots() {
      const timeSlots = [
        '07:00-09:00', '09:00-11:00', '13:00-15:00', '15:00-17:00', '17:00-19:00', '19:00-21:00'
      ];
      
      const timeSelects = [
        'classTime', 'classTime2', 'editClassTime', 'editClassTime2'
      ];
      
      timeSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
          select.innerHTML = '<option value="">-- Chọn giờ --</option>';
          timeSlots.forEach(slot => {
            const option = document.createElement('option');
            option.value = slot;
            option.textContent = slot;
            select.appendChild(option);
          });
        }
      });
    }

    function handleLogin(e) {
      e.preventDefault();
      
      const email = elements.loginEmail.value;
      const password = elements.loginPassword.value;
      
      // Show loading state
      const spinner = elements.loginBtn.querySelector('.spinner-border');
      const buttonText = elements.loginBtn.querySelector('.button-text');
      spinner.classList.remove('d-none');
      buttonText.textContent = 'Đang đăng nhập...';
      
      // Clear previous error
      elements.loginError.classList.add('d-none');
      
      // Sign in with Firebase Auth
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Login successful
          appState.currentUser = userCredential.user;
          checkUserRole(userCredential.user.uid);
        })
        .catch((error) => {
          // Login failed
          elements.loginError.textContent = error.message;
          elements.loginError.classList.remove('d-none');
          
          // Reset button state
          spinner.classList.add('d-none');
          buttonText.textContent = 'Đăng nhập';
        });
    }

    function handleLogout() {
      auth.signOut().then(() => {
        showLogin();
      });
    }

    function toggleSidebar() {
      elements.sidebar.classList.toggle('toggled');
    }

    function showPage(pageId) {
      elements.pageSections.forEach(section => {
        section.classList.remove('active');
      });
      
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
        
        // Load data for specific pages
        if (pageId === 'classes-page') {
          loadClassesTable();
        } else if (pageId === 'teachers-page') {
          loadTeachersTable();
        } else if (pageId === 'students-page') {
          loadStudentsTable();
        } else if (pageId === 'attendance-page') {
          loadAttendanceFilters();
        } else if (pageId === 'teacher-attendance-page') {
          loadTeacherAttendanceFilters();
        }
      }
    }

    function handleSearch() {
      const searchTerm = elements.searchInput.value.toLowerCase();
      
      // Filter tables based on search term
      filterTable('classesTable', searchTerm);
      filterTable('teachersTable', searchTerm);
      filterTable('studentsTable', searchTerm);
    }

    function clearSearch() {
      elements.searchInput.value = '';
      handleSearch();
    }

    function filterTable(tableId, searchTerm) {
      const table = document.getElementById(tableId);
      if (!table) return;
      
      const rows = table.querySelectorAll('tbody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    function changeCalendarView(view) {
      elements.calendar.changeView(view);
      appState.currentCalendarView = view;
    }

    function refreshCalendar() {
      // In a real app, you would fetch events from Firestore
      // For demo, we'll generate some sample events
      const events = generateSampleEvents();
      elements.calendar.removeAllEvents();
      elements.calendar.addEventSource(events);
    }

    function generateSampleEvents() {
      // Sample events for demo
      const events = [];
      const today = new Date();
      const startOfWeek = new Date(today);
      startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Start from Monday
      
      // Add some sample classes
      for (let i = 0; i < 5; i++) {
        const date = new Date(startOfWeek);
        date.setDate(startOfWeek.getDate() + i);
        
        events.push({
          title: 'Toán 10 - Lớp A1',
          start: new Date(date.getFullYear(), date.getMonth(), date.getDate(), 7, 0),
          end: new Date(date.getFullYear(), date.getMonth(), date.getDate(), 9, 0),
          extendedProps: {
            classId: 'class1',
            teacherId: 'teacher1',
            conflict: i === 2 // Mark Wednesday as having a conflict for demo
          }
        });
        
        events.push({
          title: 'Vật lý 11 - Lớp B2',
          start: new Date(date.getFullYear(), date.getMonth(), date.getDate(), 9, 0),
          end: new Date(date.getFullYear(), date.getMonth(), date.getDate(), 11, 0),
          extendedProps: {
            classId: 'class2',
            teacherId: 'teacher2'
          }
        });
      }
      
      return events;
    }

    function showAttendanceModal(event) {
      // In a real app, you would fetch class and student data from Firestore
      // For demo, we'll use sample data
      const classId = event.extendedProps.classId;
      const classData = {
        name: event.title,
        teacher: 'Nguyễn Văn A'
      };
      
      // Set modal content
      document.getElementById('attendanceClassName').textContent = classData.name;
      document.getElementById('attendanceTeacherName').textContent = classData.teacher;
      document.getElementById('attendanceDate').textContent = event.start.toLocaleDateString('vi-VN');
      
      // Generate sample student list
      const studentList = document.getElementById('attendanceTable').querySelector('tbody');
      studentList.innerHTML = '';
      
      for (let i = 1; i <= 5; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>Học sinh ${i}</td>
          <td>098765432${i}</td>
          <td>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="attendance${i}" id="present${i}" value="present" checked>
              <label class="form-check-label" for="present${i}">Có mặt</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="attendance${i}" id="absent${i}" value="absent">
              <label class="form-check-label" for="absent${i}">Vắng mặt</label>
            </div>
          </td>
        `;
        studentList.appendChild(row);
      }
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('attendanceModal'));
      modal.show();
    }

    function loadInitialData() {
      // In a real app, you would fetch data from Firestore
      // For demo, we'll use sample data
      
      // Update stats
      elements.statsClasses.textContent = '12';
      elements.statsTeachers.textContent = '8';
      elements.statsStudents.textContent = '150';
      elements.statsConflicts.textContent = '2';
      
      // Load teacher filter
      loadTeacherFilter();
      
      // Refresh calendar
      refreshCalendar();
      
      // Load tables
      loadClassesTable();
      loadTeachersTable();
      loadStudentsTable();
      
      // Show conflicts if any
      showConflicts();
    }

    function loadTeacherFilter() {
      // In a real app, you would fetch teachers from Firestore
      const teachers = [
        { id: 'all', name: 'Tất cả giáo viên' },
        { id: 'teacher1', name: 'Nguyễn Văn A' },
        { id: 'teacher2', name: 'Trần Thị B' },
        { id: 'teacher3', name: 'Lê Văn C' }
      ];
      
      elements.teacherFilterSelect.innerHTML = '';
      teachers.forEach(teacher => {
        const option = document.createElement('option');
        option.value = teacher.id;
        option.textContent = teacher.name;
        elements.teacherFilterSelect.appendChild(option);
      });
    }

    function showConflicts() {
      // In a real app, you would detect actual conflicts
      // For demo, we'll show sample conflicts
      const conflicts = [
        'Lớp Toán 10A và Lớp Vật lý 11B cùng phòng 101 vào Thứ 4, 09:00-11:00',
        'Giáo viên Nguyễn Văn A dạy 2 lớp cùng lúc vào Thứ 6, 15:00-17:00'
      ];
      
      if (conflicts.length > 0) {
        elements.conflictCard.style.display = 'block';
        elements.conflictDetailsList.innerHTML = '';
        
        conflicts.forEach(conflict => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.textContent = conflict;
          elements.conflictDetailsList.appendChild(li);
        });
      } else {
        elements.conflictCard.style.display = 'none';
      }
    }

    function loadClassesTable() {
      // In a real app, you would fetch classes from Firestore
      // For demo, we'll use sample data
      const classes = [
        { id: 1, name: 'Toán 10A', subject: 'Toán', teacher: 'Nguyễn Văn A', students: 25, schedule: 'Thứ 2, 7:00-9:00' },
        { id: 2, name: 'Vật lý 11B', subject: 'Vật lý', teacher: 'Trần Thị B', students: 20, schedule: 'Thứ 3, 9:00-11:00' },
        { id: 3, name: 'Hóa 12C', subject: 'Hóa', teacher: 'Lê Văn C', students: 18, schedule: 'Thứ 4, 13:00-15:00' }
      ];
      
      const tbody = elements.classesTable.querySelector('tbody');
      tbody.innerHTML = '';
      
      classes.forEach(cls => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td data-label="Tên lớp">${cls.name}</td>
          <td data-label="Môn">${cls.subject}</td>
          <td data-label="Giáo viên">${cls.teacher}</td>
          <td data-label="HS">${cls.students}</td>
          <td data-label="Lịch học">${cls.schedule}</td>
          <td data-label="Hành động">
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editClass(${cls.id})"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger admin-only" onclick="deleteClass(${cls.id})"><i class="bi bi-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadTeachersTable() {
      // In a real app, you would fetch teachers from Firestore
      // For demo, we'll use sample data
      const teachers = [
        { id: 1, name: 'Nguyễn Văn A', email: 'nguyenvana@example.com', subject: 'Toán', phone: '0987654321' },
        { id: 2, name: 'Trần Thị B', email: 'tranthib@example.com', subject: 'Vật lý', phone: '0987654322' },
        { id: 3, name: 'Lê Văn C', email: 'levanc@example.com', subject: 'Hóa', phone: '0987654323' }
      ];
      
      const tbody = elements.teachersTable.querySelector('tbody');
      tbody.innerHTML = '';
      
      teachers.forEach(teacher => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td data-label="Tên">${teacher.name}</td>
          <td data-label="Email">${teacher.email}</td>
          <td data-label="Môn Dạy">${teacher.subject}</td>
          <td data-label="Hành động" class="admin-only">
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editTeacher(${teacher.id})"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteTeacher(${teacher.id})"><i class="bi bi-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadStudentsTable() {
      // In a real app, you would fetch students from Firestore
      // For demo, we'll use sample data
      const students = [
        { id: 1, name: 'Phạm Văn D', phone: '0987654331', classes: 'Toán 10A, Vật lý 11B' },
        { id: 2, name: 'Hoàng Thị E', phone: '0987654332', classes: 'Toán 10A, Hóa 12C' },
        { id: 3, name: 'Vũ Văn F', phone: '0987654333', classes: 'Vật lý 11B' }
      ];
      
      const tbody = elements.studentsTable.querySelector('tbody');
      tbody.innerHTML = '';
      
      students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td data-label="Tên">${student.name}</td>
          <td data-label="SĐT Phụ huynh">${student.phone}</td>
          <td data-label="Lớp đã đăng ký">${student.classes}</td>
          <td data-label="Hành động" class="admin-only">
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editStudent(${student.id})"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent(${student.id})"><i class="bi bi-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadAttendanceFilters() {
      // In a real app, you would fetch classes and students from Firestore
      // For demo, we'll use sample data
      const classes = [
        { id: 'all', name: 'Tất cả lớp' },
        { id: 'class1', name: 'Toán 10A' },
        { id: 'class2', name: 'Vật lý 11B' },
        { id: 'class3', name: 'Hóa 12C' }
      ];
      
      elements.attendanceClassFilter.innerHTML = '';
      classes.forEach(cls => {
        const option = document.createElement('option');
        option.value = cls.id;
        option.textContent = cls.name;
        elements.attendanceClassFilter.appendChild(option);
      });
      
      updateAttendanceStudentFilter();
    }

    function updateAttendanceStudentFilter() {
      // In a real app, you would fetch students based on selected class
      // For demo, we'll use sample data
      const students = [
        { id: 'all', name: 'Tất cả học sinh' },
        { id: 'student1', name: 'Phạm Văn D' },
        { id: 'student2', name: 'Hoàng Thị E' },
        { id: 'student3', name: 'Vũ Văn F' }
      ];
      
      elements.attendanceStudentFilter.innerHTML = '';
      students.forEach(student => {
        const option = document.createElement('option');
        option.value = student.id;
        option.textContent = student.name;
        elements.attendanceStudentFilter.appendChild(option);
      });
    }

    function loadAttendanceHistory() {
      // In a real app, you would fetch attendance data from Firestore
      // For demo, we'll use sample data
      const attendanceData = [
        { date: '2024-01-15', className: 'Toán 10A', teacher: 'Nguyễn Văn A', present: 22, absent: 3 },
        { date: '2024-01-16', className: 'Vật lý 11B', teacher: 'Trần Thị B', present: 18, absent: 2 },
        { date: '2024-01-17', className: 'Hóa 12C', teacher: 'Lê Văn C', present: 16, absent: 2 }
      ];
      
      const tbody = elements.attendanceHistoryTable.querySelector('tbody');
      tbody.innerHTML = '';
      
      if (attendanceData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center">Không có dữ liệu điểm danh phù hợp.</td></tr>';
        return;
      }
      
      attendanceData.forEach(record => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${record.date}</td>
          <td>${record.className}</td>
          <td>${record.teacher}</td>
          <td>${record.present}</td>
          <td>${record.absent}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadTeacherAttendanceFilters() {
      // In a real app, you would fetch teachers and classes from Firestore
      // For demo, we'll use sample data
      const teachers = [
        { id: 'teacher1', name: 'Nguyễn Văn A' },
        { id: 'teacher2', name: 'Trần Thị B' },
        { id: 'teacher3', name: 'Lê Văn C' }
      ];
      
      elements.teacherAttendanceFilter.innerHTML = '<option value="">-- Chọn giáo viên --</option>';
      teachers.forEach(teacher => {
        const option = document.createElement('option');
        option.value = teacher.id;
        option.textContent = teacher.name;
        elements.teacherAttendanceFilter.appendChild(option);
      });
      
      const classes = [
        { id: '', name: 'Tất cả lớp' },
        { id: 'class1', name: 'Toán 10A' },
        { id: 'class2', name: 'Vật lý 11B' },
        { id: 'class3', name: 'Hóa 12C' }
      ];
      
      elements.attendanceClassFilterTeacher.innerHTML = '';
      classes.forEach(cls => {
        const option = document.createElement('option');
        option.value = cls.id;
        option.textContent = cls.name;
        elements.attendanceClassFilterTeacher.appendChild(option);
      });
    }

    function loadTeacherAttendance() {
      const teacherId = elements.teacherAttendanceFilter.value;
      const date = elements.attendanceDateFilter.value;
      const classId = elements.attendanceClassFilterTeacher.value;
      
      if (!teacherId) {
        elements.teacherAttendanceContent.innerHTML = `
          <div class="text-center p-4 text-muted">
            <i class="bi bi-person-check fs-1"></i>
            <p class="mt-2">Vui lòng chọn giáo viên để xem danh sách điểm danh</p>
          </div>
        `;
        return;
      }
      
      // In a real app, you would fetch data from Firestore based on filters
      // For demo, we'll use sample data
      const teacherName = elements.teacherAttendanceFilter.options[elements.teacherAttendanceFilter.selectedIndex].text;
      const classes = [
        {
          id: 'class1',
          name: 'Toán 10A',
          students: [
            { id: 'student1', name: 'Phạm Văn D', phone: '0987654331', status: 'present' },
            { id: 'student2', name: 'Hoàng Thị E', phone: '0987654332', status: 'present' },
            { id: 'student3', name: 'Vũ Văn F', phone: '0987654333', status: 'absent' }
          ]
        },
        {
          id: 'class2',
          name: 'Vật lý 11B',
          students: [
            { id: 'student4', name: 'Nguyễn Thị G', phone: '0987654334', status: 'present' },
            { id: 'student5', name: 'Trần Văn H', phone: '0987654335', status: 'present' }
          ]
        }
      ];
      
      let filteredClasses = classes;
      if (classId) {
        filteredClasses = classes.filter(cls => cls.id === classId);
      }
      
      let html = `
        <div class="mb-4">
          <h6 class="fw-bold mb-2">Giáo viên: ${teacherName}</h6>
          <p class="mb-0">Ngày điểm danh: ${date}</p>
        </div>
      `;
      
      filteredClasses.forEach(cls => {
        html += `
          <div class="teacher-attendance-card">
            <div class="card-header">${cls.name}</div>
            <div class="card-body p-0">
        `;
        
        cls.students.forEach(student => {
          html += `
            <div class="attendance-student-row">
              <div class="student-info">
                <div class="student-name">${student.name}</div>
                <div class="student-phone">${student.phone}</div>
              </div>
              <div class="attendance-actions">
                <div class="attendance-btn ${student.status === 'present' ? 'active' : ''}" data-student="${student.id}" data-status="present">
                  <i class="bi bi-check-lg text-success"></i>
                </div>
                <div class="attendance-btn absent ${student.status === 'absent' ? 'active' : ''}" data-student="${student.id}" data-status="absent">
                  <i class="bi bi-x-lg text-danger"></i>
                </div>
              </div>
            </div>
          `;
        });
        
        html += `
            </div>
            <div class="attendance-summary">
              <span>Tổng: ${cls.students.length} học sinh</span>
              <span>Có mặt: ${cls.students.filter(s => s.status === 'present').length}</span>
              <span>Vắng: ${cls.students.filter(s => s.status === 'absent').length}</span>
            </div>
          </div>
        `;
      });
      
      elements.teacherAttendanceContent.innerHTML = html;
      
      // Add event listeners to attendance buttons
      document.querySelectorAll('.attendance-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const studentId = this.getAttribute('data-student');
          const status = this.getAttribute('data-status');
          
          // Update UI
          const parentRow = this.closest('.attendance-student-row');
          parentRow.querySelectorAll('.attendance-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // In a real app, you would save the attendance to Firestore
          console.log(`Marked student ${studentId} as ${status}`);
          
          // Update summary
          updateAttendanceSummary(parentRow.closest('.teacher-attendance-card'));
        });
      });
    }

    function updateAttendanceSummary(card) {
      const studentRows = card.querySelectorAll('.attendance-student-row');
      const total = studentRows.length;
      const present = Array.from(studentRows).filter(row => 
        row.querySelector('.attendance-btn[data-status="present"]').classList.contains('active')
      ).length;
      const absent = total - present;
      
      const summary = card.querySelector('.attendance-summary');
      summary.innerHTML = `
        <span>Tổng: ${total} học sinh</span>
        <span>Có mặt: ${present}</span>
        <span>Vắng: ${absent}</span>
      `;
    }

    // Placeholder functions for edit/delete operations
    function editTeacher(id) {
      alert(`Edit teacher with ID: ${id}`);
    }

    function deleteTeacher(id) {
      if (confirm('Bạn có chắc chắn muốn xóa giáo viên này?')) {
        alert(`Delete teacher with ID: ${id}`);
      }
    }

    function editStudent(id) {
      alert(`Edit student with ID: ${id}`);
    }

    function deleteStudent(id) {
      if (confirm('Bạn có chắc chắn muốn xóa học sinh này?')) {
        alert(`Delete student with ID: ${id}`);
      }
    }

    function editClass(id) {
      alert(`Edit class with ID: ${id}`);
    }

    function deleteClass(id) {
      if (confirm('Bạn có chắc chắn muốn xóa lớp học này?')) {
        alert(`Delete class with ID: ${id}`);
      }
    }
  </script>
</body>
</html>